---
title: "The Greatest Hitters of All Time"
date: '2016-05-28'
layout: post
output: html_document
categories: baseball
---

```{r include = FALSE}
###############################################################################
# Project: Baseball
# Author(s): Thomas Burr
# Date created: 2015 05 26
###############################################################################


################################################################################
# load in libraries and source files
################################################################################


# libraries:
librariesToLoad <- c( 'plyr','tidyr','knitr', 'ggplot2',
                     'scales','ggthemes','Lahman','dplyr')

suppressWarnings(suppressMessages(expr={
    sapply(librariesToLoad, function(package) {
        if (require(package, character.only=TRUE)){     
            print(paste(package, "loaded correctly", sep=" "))
        } else {
            print(paste("Installing", package, sep=" "))
            install.packages(package,repos="http://cran.rstudio.com/")
            
            if (require(package, character.only=TRUE)){
              print(paste(package, "loaded correctly", sep=" "))
            } else {
                stop(paste("Could not install", package, sep=" "))
            }
        }
    })
}))


```

###Introduction

Who were the greatest hitters of all time? Who had the best seasons? Is it finding out as easy as this?

```{r}
#Import bstats from the Lahman dataset, using the Lahman R package
bstats <- tbl_df(battingStats())

#Filter to the Modern Era, NL and AL Only
bstats <- bstats %>% filter(yearID > 1900 & lgID %in% c("NL","AL"))

#Collect player names from Master Dataset, then merge on bstats
master <- tbl_df(Master) %>% select(playerID,nameFirst,nameLast)
bstats <- full_join(bstats,master,by = "playerID")

#Qualifications: Must have at least 400 plate appearances

greatest_seasons <- bstats %>% filter(PA > 400) %>% 
                               arrange(desc(BA)) %>% 
                               select(nameFirst,nameLast,BA,yearID)

#Pretty display with kable
kable(greatest_seasons[1:15,],caption = "Top 10 Batting Seasons in History")
```

Baseball's finest hour has passed! There hasn't been a .400 hitter since 1941, and 9 of the ten top seasons happened before 1925! They just don't make 'em like Nap Lajoie anymore!

Obviously this argument doesn't hold up. Batting average is not a solitary statistic, but one composed of the skill of not only the batter, but also the pitcher and fielders against whom he his playing. 

For a simple explanation, here is  Ty Cobb's glove from his 1911 .420 season:


<div style="width:300px; height=200px;margin: auto">
![](http://baseballhall.org/sites/default/files/styles/fullscreen_image_popup/public/externals/5431720de9843cd3dea7ccfdc78a601f.jpeg)
</div>


For a more complex treatment, here is what evolutionary biologist Stephen Gould has to say on the supposed "disappearance" of the .400 hitter:


> The overall batting average has been about .260 throughout the history of baseball. But the variation around that average has shrunk. It's at least plausible that variation declines because play improves. A batting average is a comparison between hitting and pitching. So if everybody's improving, as long as they improve at the same rate, the batting average will remain constant. But it gets to the point where everyone is so good that there's just not much variation anymore. Hitting .400 in baseball is a good example because there's a "right wall," if you will, of human limits. Given how our muscles work, there's just so much that the human body can do. There will always be a few individuals who, by dint of genetic gifts and obsessive commitment and training, will stand close to that right wall. That's where Ty Cobb was in 1911 and where Tony Gwynn is today. But there is this limiting wall. What has happened in baseball is that all aspects of play have improved enormously. Back in 1911, average play was so far inferior to where Ty Cobb was that his batting average could be measured as .420. Today, Tony Gwynn is just as good, maybe even closer to the wall than Cobb was. But the average player has improved so much that Gwynn's performance -- equal to or better than Cobb's -- is not measured as high.

In sum: It should be obvious that player performance has improved over time. The reason we don't see .400 hitters anymore is that as players colelctively approach the right limit of human achivement, variation shrinks. Cobb and Hornsby were able to put up such gaudy numbers because they were simply closer to this point before everyone else caught up.

This brings me to my question: If we measure performance ***relative*** to one's time, how does the above table change? Who actually had the best, or perhaps more accurately ***transcendant*** seasons of all time?

###The Greatest Hitting Seasons

First, I would like to test Gould's central claim:

> The overall batting average has been about .260 throughout the history of baseball. But the variation around that average has shrunk." 

To test that claim, I look at the league-level batting average for players who hat at least 400 plate apperances in a season.

```{r}
yearly_bstats <- bstats %>% filter(PA > 400) %>%
                            group_by(yearID) %>%
                            summarize(ba_avg = mean(BA),
                                      num_qualified = n())

ggplot(yearly_bstats,aes(x = yearID,y = ba_avg)) + geom_line() + theme_wsj() + scale_y_continuous(breaks = c(.240,.250,.260,.270,.280,.290,.300,.310),
                   labels = c('.240','.250','.260','.270',
                              '.280','.290','.300','.310'))



```

To a first approximation, Gould's claim appears to be a bit of an overstatement. In the modern era, batting averages for qualified hitters have a range of over 50 points. Of our list of .400 hitters, all but one of them (Ted Williams) accomplished this feat in a season where the league batting average was over .280. 



```{r fig.width == 10}
ba_league_leaders <- bstats %>% filter(PA > 400 | AB > 500) %>% 
                                group_by(yearID) %>% 
                                slice(which.max(BA)) %>% 
                                ungroup() %>% 
                                select(ba_leader = playerID,
                                       yearID,
                                       ba_leader_ba = BA)

slg_league_leaders <- bstats %>% filter(PA > 400 | AB > 500) %>% 
                                 group_by(yearID) %>% 
                                 slice(which.max(SlugPct)) %>% 
                                 ungroup() %>% 
                                 select(slg_leader = playerID,
                                        yearID,
                                        slg_leader_slg = SlugPct,
                                        slg_leader_ba = BA)

league_leaders <- merge(ba_league_leaders,slg_league_leaders,by = "yearID")


bstats <- left_join(bstats,league_leaders, by = "yearID")

ggplot(ba_league_leaders,aes(x= yearID,y = ba_leader_ba,label = ba_leader)) + geom_text()
```


Include in stdev everyone with at least 200 at bats

```{r}
yearly_bstats <- bstats %>% filter(PA > 400)
yearly_bstats <- yearly_bstats %>% group_by(yearID) %>% summarise(
                                              num_qualified = n(),
                                              ba_std = sd(BA),
                                              slg_std = sd(SlugPct),
                                              ba_avg = mean(BA),
                                              slg_avg = mean(SlugPct))

bstats <- left_join(bstats,yearly_bstats,by= 'yearID')
yearly_bstats <- merge(yearly_bstats,league_leaders,by="yearID")

```

One problem, however, is that these stats can only be calculated at the player level. Thus if we were to, for example, average all batting averages in a year, a player with 50 PA would weight equally as one with 500. We can get around this by creating a year-level total of the underlying stats (Hits, walks, 2B, HR etc.) and recalculating the percentages at a year level.


```{r}

ggplot(yearly_bstats,aes(x = yearID,y = ba_avg)) + geom_line() + theme_wsj() + scale_y_continuous(breaks = c(.240,.250,.260,.270,.280,.290,.300,.310),
                   labels = c('.240','.250','.260','.270',
                              '.280','.290','.300','.310'))

tidy_batting_percentages <- gather(yearly_bstats,statistic,average,ba_avg,slg_avg)


ggplot(tidy_batting_percentages,aes(x = yearID,y = average,color = statistic)) + geom_line() + theme_wsj() 


```


Batting Average vs league leader?

```{r}


ggplot(yearly_bstats,aes(x = yearID,y = ba_avg)) + geom_line() +stat_smooth(method = "lm") + theme_wsj() +ylim(.200,.450) +geom_point(data = yearly_bstats,aes(x=yearID,y=ba_leader_ba)) + theme_fivethirtyeight()

yearly_bstats$ba_max_spread <- yearly_bstats$ba_leader_ba - yearly_bstats$ba_avg

ggplot(yearly_bstats,aes(x = yearID,y = ba_max_spread, label = ba_leader)) + geom_point() +stat_smooth() + theme_wsj() +ylim(0,.200)

```

```{r}
ggplot(yearly_bstats,aes(x = yearID,y = slg_avg)) + geom_line() +stat_smooth(method = "lm") + theme_wsj() +ylim(.300,.800) +geom_point(data = yearly_bstats,aes(x=yearID,y=slg_leader_slg))

yearly_bstats$max_slg_spread<- yearly_bstats$slg_leader_slg- yearly_bstats$slg_avg

ggplot(yearly_bstats,aes(x = yearID,y = max_slg_spread)) + geom_point() +stat_smooth(method = "lm") + theme_fivethirtyeight() +ylim(0,.500)
```


```{r}

yearly_bstats <- yearly_bstats %>% mutate(std_away_ba = (ba_leader_ba - ba_avg)/ba_std,
                                          std_away_slg = (slg_leader_slg - slg_avg)/slg_std)

bstats <- bstats %>% filter(PA > 400) %>% mutate(std_away_ba = (BA - ba_avg)/ba_std,
                                          std_away_slg = (SlugPct - slg_avg)/slg_std)

ggplot(yearly_bstats,aes(x=yearID,y=std_away_ba,label = ba_leader)) + geom_text()
ggplot(yearly_bstats,aes(x=yearID,y=std_away_slg,label = slg_leader)) + geom_text()



```
